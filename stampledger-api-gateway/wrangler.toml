# Cloudflare Worker configuration for StampLedger API Gateway
name = "stampledger-api-gateway"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]
workers_dev = true

# KV namespace for caching (create with: wrangler kv:namespace create "CACHE")
# [[kv_namespaces]]
# binding = "CACHE"
# id = "<your-kv-namespace-id>"

# Rate limiting with Durable Objects
# [[durable_objects.bindings]]
# name = "RATE_LIMITER"
# class_name = "RateLimiter"

# [[migrations]]
# tag = "v1"
# new_classes = ["RateLimiter"]

[vars]
# Blockchain RPC endpoint (internal - via Cloudflare Tunnel)
CHAIN_RPC_URL = "http://localhost:26657"
# Allowed origins for CORS
ALLOWED_ORIGINS = "https://stampledger.com,https://app.stampledger.com"
# Rate limit: requests per minute
RATE_LIMIT_RPM = "60"

[env.preview]
vars = { CHAIN_RPC_URL = "http://localhost:26657", ALLOWED_ORIGINS = "*" }

[env.production]
# Set CHAIN_RPC_URL to your server IP or Cloudflare Tunnel domain
# e.g. "https://rpc.stampledger.com" or "http://YOUR_VPS_IP:26657"
vars = { CHAIN_RPC_URL = "https://rpc.stampledger.com", ALLOWED_ORIGINS = "https://stampledger.com,https://app.stampledger.com,https://portal.stampledger.com" }

# Routes (uncomment when ready to deploy)
# routes = [
#   { pattern = "api.stampledger.com/*", zone_name = "stampledger.com" }
# ]
