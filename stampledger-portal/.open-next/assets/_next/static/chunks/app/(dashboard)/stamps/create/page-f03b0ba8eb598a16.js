(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[360],{1991:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var s=a(5155),l=a(2115),r=a(5695),i=a(6052),n=a(7168),c=a(9852),d=a(5784),o=a(5169),u=a(2915),m=a(9869),x=a(2138),h=a(5448),p=a(5525),f=a(7624),y=a(2239);let g=[{id:"wisconsin",name:"Wisconsin"},{id:"california",name:"California"},{id:"texas",name:"Texas"},{id:"new-york",name:"New York"},{id:"florida",name:"Florida"}];function v(){var e;let t=(0,r.useRouter)(),{token:a,user:v}=(0,i.A)(),[b,j]=(0,l.useState)("upload"),[w,N]=(0,l.useState)(!1),[k,S]=(0,l.useState)(""),[A,C]=(0,l.useState)(null),[P,E]=(0,l.useState)(""),[z,F]=(0,l.useState)(""),[O,R]=(0,l.useState)(""),[D,T]=(0,l.useState)(""),[H,I]=(0,l.useState)(""),[M,$]=(0,l.useState)(null),L=(0,l.useCallback)(async e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){C(a),S("");try{let e=await (0,y.mk)(a);E(e)}catch(e){S("Failed to process file")}}},[]),V=(0,l.useCallback)(async e=>{e.preventDefault();let t=e.dataTransfer.files[0];if(t){C(t),S("");try{let e=await (0,y.mk)(t);E(e)}catch(e){S("Failed to process file")}}},[]),_=async()=>{if(a){N(!0),S("");try{let e=await fetch("/api/stamps",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({documentHash:P,jurisdictionId:z,projectName:O||null,permitNumber:D||null,notes:H||null,documentFilename:null==A?void 0:A.name,documentSize:null==A?void 0:A.size})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to create stamp")}let t=await e.json();$(t.stamp),j("success")}catch(e){S(e instanceof Error?e.message:"Failed to create stamp")}finally{N(!1)}}},B=A&&P;return(0,s.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("button",{onClick:()=>{"upload"===b?t.back():"details"===b?j("upload"):"review"===b&&j("details")},className:"p-2 hover:bg-gray-100 rounded-lg",disabled:"success"===b,children:(0,s.jsx)(o.A,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-primary",children:"Create Stamp"}),(0,s.jsxs)("p",{className:"text-gray-600",children:["upload"===b&&"Step 1: Upload your document","details"===b&&"Step 2: Enter project details","review"===b&&"Step 3: Review and confirm","success"===b&&"Stamp created successfully"]})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:["upload","details","review","success"].map((e,t)=>(0,s.jsx)("div",{className:"flex-1 h-2 rounded-full ".concat(["upload","details","review","success"].indexOf(b)>=t?"bg-cta":"bg-gray-200")},e))}),k&&(0,s.jsx)("div",{className:"bg-red-50 text-red-600 px-4 py-3 rounded-lg",children:k}),"upload"===b&&(0,s.jsxs)("div",{className:"card space-y-6",children:[(0,s.jsx)("div",{onDrop:V,onDragOver:e=>e.preventDefault(),className:"border-2 border-dashed rounded-xl p-8 text-center transition-colors ".concat(A?"border-accent bg-accent/5":"border-gray-300 hover:border-cta"),children:A?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-accent/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto",children:(0,s.jsx)(u.A,{className:"h-8 w-8 text-accent"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-gray-900",children:A.name}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[(A.size/1024/1024).toFixed(2)," MB"]})]}),P&&(0,s.jsxs)("div",{className:"bg-gray-100 rounded-lg p-3",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"SHA-256 Hash"}),(0,s.jsx)("p",{className:"text-xs font-mono text-gray-700 break-all",children:P})]})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"bg-gray-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto",children:(0,s.jsx)(m.A,{className:"h-8 w-8 text-gray-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-gray-900",children:"Drop your document here"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"or click to browse"})]}),(0,s.jsx)("input",{type:"file",onChange:L,accept:".pdf,.dwg",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})}),(0,s.jsxs)(n.$,{onClick:()=>j("details"),disabled:!B,className:"w-full",children:["Continue",(0,s.jsx)(x.A,{className:"h-4 w-4 ml-2"})]})]}),"details"===b&&(0,s.jsxs)("div",{className:"card space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"input-label",children:"Jurisdiction *"}),(0,s.jsxs)(d.l,{value:z,onChange:e=>F(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select jurisdiction"}),g.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"input-label",children:"Project Name"}),(0,s.jsx)(c.p,{placeholder:"e.g., Smith Residence Addition",value:O,onChange:e=>R(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"input-label",children:"Permit Number"}),(0,s.jsx)(c.p,{placeholder:"e.g., E-2026-1234",value:D,onChange:e=>T(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"input-label",children:"Notes"}),(0,s.jsx)("textarea",{className:"flex w-full rounded-lg border border-gray-300 bg-white px-4 py-3 text-base placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cta focus-visible:ring-offset-2",rows:3,placeholder:"Any additional notes...",value:H,onChange:e=>I(e.target.value)})]}),(0,s.jsxs)(n.$,{onClick:()=>j("review"),disabled:!z,className:"w-full",children:["Review Stamp",(0,s.jsx)(x.A,{className:"h-4 w-4 ml-2"})]})]}),"review"===b&&(0,s.jsxs)("div",{className:"card space-y-6",children:[(0,s.jsxs)("div",{className:"bg-primary/5 rounded-xl p-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Stamp Summary"}),(0,s.jsxs)("dl",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("dt",{className:"text-gray-600",children:"Document"}),(0,s.jsx)("dd",{className:"font-medium text-gray-900",children:null==A?void 0:A.name})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("dt",{className:"text-gray-600",children:"Jurisdiction"}),(0,s.jsx)("dd",{className:"font-medium text-gray-900",children:null==(e=g.find(e=>e.id===z))?void 0:e.name})]}),O&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("dt",{className:"text-gray-600",children:"Project"}),(0,s.jsx)("dd",{className:"font-medium text-gray-900",children:O})]}),D&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("dt",{className:"text-gray-600",children:"Permit #"}),(0,s.jsx)("dd",{className:"font-medium text-gray-900",children:D})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("dt",{className:"text-gray-600",children:"PE"}),(0,s.jsxs)("dd",{className:"font-medium text-gray-900",children:[null==v?void 0:v.name,(null==v?void 0:v.peLicenseNumber)&&" (".concat(v.peState,"-").concat(v.peLicenseNumber,")")]})]})]})]}),(0,s.jsxs)("div",{className:"bg-gray-100 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(h.A,{className:"h-4 w-4 text-gray-500"}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Document Hash"})]}),(0,s.jsx)("p",{className:"text-xs font-mono text-gray-700 break-all",children:P})]}),(0,s.jsx)("div",{className:"bg-cta/5 border border-cta/20 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(p.A,{className:"h-5 w-5 text-cta mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:"This stamp will be permanently recorded"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Once created, this stamp cannot be deleted. You can revoke it if needed, but the record will remain on the blockchain."})]})]})}),(0,s.jsx)(n.$,{onClick:_,disabled:w,className:"w-full",children:w?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating stamp..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Create Stamp"]})})]}),"success"===b&&M&&(0,s.jsxs)("div",{className:"card text-center space-y-6",children:[(0,s.jsx)("div",{className:"bg-accent/10 w-20 h-20 rounded-full flex items-center justify-center mx-auto",children:(0,s.jsx)(u.A,{className:"h-10 w-10 text-accent"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Stamp Created Successfully"}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:"Your document has been stamped and recorded."})]}),M.qrCodeDataUrl&&(0,s.jsxs)("div",{className:"bg-white border rounded-xl p-6 inline-block",children:[(0,s.jsx)("img",{src:M.qrCodeDataUrl,alt:"Verification QR Code",className:"w-48 h-48 mx-auto"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Scan to verify this stamp"})]}),(0,s.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,s.jsx)(n.$,{variant:"secondary",onClick:()=>t.push("/stamps"),children:"View All Stamps"}),(0,s.jsx)(n.$,{onClick:()=>t.push("/stamps/".concat(M.id)),children:"View Stamp Details"})]})]})]})}},2138:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},2239:(e,t,a)=>{"use strict";async function s(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}a.d(t,{mk:()=>s})},2915:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},3999:(e,t,a)=>{"use strict";a.d(t,{cn:()=>r});var s=a(2596),l=a(9688);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,l.QP)((0,s.$)(t))}},5169:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5448:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]])},5467:(e,t,a)=>{Promise.resolve().then(a.bind(a,1991))},5525:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},5784:(e,t,a)=>{"use strict";a.d(t,{l:()=>i});var s=a(5155),l=a(2115),r=a(3999);let i=l.forwardRef((e,t)=>{let{className:a,children:l,...i}=e;return(0,s.jsx)("select",{className:(0,r.cn)("flex h-12 w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-base ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cta focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...i,children:l})});i.displayName="Select"},6052:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,AuthProvider:()=>n});var s=a(5155),l=a(2115),r=a(5695);let i=(0,l.createContext)(void 0);function n(e){let{children:t}=e,[a,n]=(0,l.useState)(null),[c,d]=(0,l.useState)(null),[o,u]=(0,l.useState)(!0),m=(0,r.useRouter)();(0,l.useEffect)(()=>{let e=localStorage.getItem("token");e?(d(e),x(e)):u(!1)},[]);let x=async e=>{try{let t=await fetch("/api/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();n(e.user)}else localStorage.removeItem("token"),d(null)}catch(e){console.error("Failed to fetch user:",e),localStorage.removeItem("token"),d(null)}finally{u(!1)}},h=async(e,t)=>{let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!a.ok)throw Error((await a.json()).error||"Login failed");let s=await a.json();localStorage.setItem("token",s.token),d(s.token),n(s.user),m.push("/")},p=async e=>{let t=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Registration failed");let a=await t.json();localStorage.setItem("token",a.token),d(a.token),n(a.user),m.push("/")};return(0,s.jsx)(i.Provider,{value:{user:a,token:c,loading:o,login:h,register:p,logout:()=>{localStorage.removeItem("token"),d(null),n(null),m.push("/login")}},children:t})}function c(){let e=(0,l.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7168:(e,t,a)=>{"use strict";a.d(t,{$:()=>c});var s=a(5155),l=a(2115),r=a(2085),i=a(3999);let n=(0,r.F)("inline-flex items-center justify-center rounded-lg font-semibold transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-cta text-white hover:bg-cta-hover shadow-md hover:shadow-lg focus-visible:ring-cta",secondary:"border-2 border-primary text-primary hover:bg-primary hover:text-white",outline:"border-2 border-gray-300 text-gray-700 hover:bg-gray-50",ghost:"hover:bg-gray-100 text-gray-700",link:"text-cta underline-offset-4 hover:underline",accent:"bg-accent text-white hover:bg-accent-dark shadow-md hover:shadow-lg",teal:"bg-secondary text-white hover:bg-secondary-dark shadow-md hover:shadow-lg",danger:"bg-red-600 text-white hover:bg-red-700 shadow-md hover:shadow-lg"},size:{default:"px-6 py-3",sm:"px-4 py-2 text-sm",lg:"px-8 py-4 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=l.forwardRef((e,t)=>{let{className:a,variant:l,size:r,...c}=e;return(0,s.jsx)("button",{className:(0,i.cn)(n({variant:l,size:r,className:a})),ref:t,...c})});c.displayName="Button"},7624:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9852:(e,t,a)=>{"use strict";a.d(t,{p:()=>i});var s=a(5155),l=a(2115),r=a(3999);let i=l.forwardRef((e,t)=>{let{className:a,type:l,...i}=e;return(0,s.jsx)("input",{type:l,className:(0,r.cn)("flex h-12 w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-base ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cta focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...i})});i.displayName="Input"},9869:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(2895).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])}},e=>{e.O(0,[987,441,964,358],()=>e(e.s=5467)),_N_E=e.O()}]);